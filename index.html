<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å•†å“ç¸½è¦½ï¼ˆè©¢åƒ¹ï¼‰</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .product { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .actions { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>å•†å“ç¸½è¦½ï¼ˆè©¢åƒ¹æ¸¬è©¦ç‰ˆï¼‰</h2>
  <div id="product-list"></div>
  <div class="actions">
    <button onclick="handleInquiry()">ğŸ” è©¢åƒ¹</button>
  </div>

  <script>
    const products = [
      { id: "11111002-20", name: "é†¬æ²¹ç¢Ÿ-KY114å¤§(å¤*PS)160å…¥*30åŒ…", packages: [{ unit: "åŒ…" }] },
      { id: "88110000-A021", name: "åœ“å¤¢æ´—æ‰‹ä¹³*1GL*ä½›æ‰‹æŸ‘æ©˜é¦™*A", packages: [{ unit: "æ¡¶" }] },
      { id: "29020001-30", name: "ä¿æº«èŒ¶æ¡¶-é°æ»¿èŒ¶æ¡¶15L-9905", packages: [{ unit: "å€‹" }] },
      { id: "34070004-0167", name: "å£ç½©-KF94å°ç«‹é«”4å±¤é†«ç™‚*10å…¥*ç™½è‰²", packages: [{ unit: "ç›’" }] }
    ];

    const selectedProducts = {};

    function renderProducts() {
      const container = document.getElementById("product-list");
      products.forEach((product) => {
        const html = `
          <div class="product">
            <label>
              <input type="checkbox" onchange="toggleProduct('${product.id}', this.checked)">
              ${product.name}
            </label>
            <select id="select-${product.id}">
              ${product.packages.map(p => `<option value="${p.unit}">${p.unit}</option>`).join('')}
            </select>
          </div>
        `;
        container.insertAdjacentHTML("beforeend", html);
      });
    }

    function toggleProduct(id, checked) {
      const unit = document.getElementById("select-" + id).value;
      if (checked) {
        selectedProducts[id] = unit;
      } else {
        delete selectedProducts[id];
      }
    }

    async function handleInquiry() {
      const selectedItems = Object.entries(selectedProducts)
        .map(([id, unit]) => `- ${id}ï¼ˆ${unit}ï¼‰`)
        .join("\n");

      const message = `æ‚¨å¥½ï¼Œæˆ‘æƒ³è©¢å•ä»¥ä¸‹å•†å“çš„åƒ¹æ ¼ï¼š\n${selectedItems}`;

      if (!liff.isInClient()) {
        alert("è«‹åœ¨ LINE ä¸­é–‹å•Ÿæ­¤é é¢æ‰èƒ½é€å‡ºè¨Šæ¯ã€‚");
        return;
      }

      try {
        await liff.sendMessages([
          { type: "text", text: message }
        ]);
        alert("è©¢åƒ¹è¨Šæ¯å·²ç™¼é€ï¼");
      } catch (err) {
        alert("ç™¼é€å¤±æ•—ï¼š" + err);
      }
    }

    async function initLiff() {
      try {
        await liff.init({ liffId: "1657969057-v3Y9bp9A" });
        renderProducts();
      } catch (error) {
        alert("LIFF åˆå§‹åŒ–å¤±æ•—ï¼š" + error);
      }
    }

    initLiff();
  </script>
</body>
</html>
